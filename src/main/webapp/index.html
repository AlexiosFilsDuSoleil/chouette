<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>First App Mythrill</title>
</head>
<body>



	<script src="https://unpkg.com/mithril/mithril.js"></script>
	<script>	


	
//Affichage de la page
	var Hello = {
		    view: function() {
		    	return m("main", [
		            m("h1", {class: "title"}, "TinyPet in Cloud'Giroffle"),
		            m("h2", {class: "title"}, "Liste des pétitions :"),
		            m("div", {id: "box"}, m(PetitionView)),
		            m("h2", {class: "title"}, "Formulaire de création de pétition :"),
		            m("div", {id: "petitionFormorm"}, m(CreationPetitionForm)),
		            m("h2", {class: "title"}, "Formulaire de création de vote :"),
		            m("div", {id: "voteForm"}, m(CreationVoteForm)),
		        ])
		    }
		}	
	

	
//PETITIONS
var Petition = {
		
		//Charger les données pour créer la liste des pétitions existantes
    	list: [],
    	loadList: function() {
        	return m.request({
            	method: "GET",
            	url: "https://tinypetincloudgiroffle.appspot.com/_ah/api/myApi/v1/entity/"
        	})
        	.then(function(result) {
            	Petition.list = result.items
        		console.log("got:",result.items)
        		m.redraw(true) // force
        	})
    	},
    	
    	current: {},
    	
    	//Sauvegarde des données via le formulaire
    	save: function() {
    		console.log("saving...",Petition.current)
    		console.log("https://tinypetincloudgiroffle.appspot.com/_ah/api/myApi/v1/addPetition/"+Petition.current.mailAuteurPetition+"/"+Petition.current.titrePetition+"/"+Petition.current.descriptionPetition)
        	return m.request({
	            method: "POST",
	            url: "https://tinypetincloudgiroffle.appspot.com/_ah/api/myApi/v1/addPetition/"+Petition.current.mailAuteurPetition+"/"+Petition.current.titrePetition+"/"+Petition.current.descriptionPetition
	            
        	})
        	.then(function(result) {
        		console.log("got:",result)
        		Petition.loadList()
        	})
    	}
	}
	
	//VOTE
	var Vote = {
			
			//Charger les données pour créer la liste des pétitions existantes
	    	list: [],
	    	/*loadList: function() {
	        	return m.request({
	            	method: "GET",
	            	url: "https://tinypetincloudgiroffle.appspot.com/_ah/api/myApi/v1/entity/"
	        	})
	        	.then(function(result) {
	            	Vote.list = result.items
	        		console.log("got:",result.items)
	        		m.redraw(true) // force
	        	})
	    	},*/
	    	
	    	current: {},
	    	
	    	//Sauvegarde des données via le formulaire
	    	save: function() {
	    		console.log("saving...",Vote.current)
	    		console.log("https://tinypetincloudgiroffle.appspot.com/_ah/api/myApi/v1/addVote/"+Vote.current.titrePetitionVote+"/"+Vote.current.mailVotant+"/"+Vote.current.nomVotant+"/"+Vote.current.prenomVotant)
	        	return m.request({
		            method: "POST",
		            url: "https://tinypetincloudgiroffle.appspot.com/_ah/api/myApi/v1/addVote/"+Vote.current.titrePetitionVote+"/"+Vote.current.mailVotant+"/"+Vote.current.nomVotant+"/"+Vote.current.prenomVotant
		            
	        	})
	        	.then(function(result) {
	        		console.log("got:",result)
	        		//Vote.loadList()
	        	})
	    	}
		}

//RECUPERATION DES PETITIONS ET AFFICHAGE
var PetitionView = {
		oninit: Petition.loadList,
	    view: function() {
	        return m(".user-list", Petition.list.map(function(item) {
	            return m(".user-list-item", "- " + item.properties.mailAuteurPetition + " a posté " + item.properties.titrePetition + " " + item.properties.descriptionPetition)
	        }))
	    },
		
}










//Formulaire de création de pétition
var CreationPetitionForm = {
			view: function() {
		        return m("form", {
		                onsubmit: function(e) {
		                    e.preventDefault()
		                    Petition.save()
		                }
		            }, [
		            m("label.label", "Votre adresse mail : "),
		            m("input.input[type=text][placeholder=Votre adresse email]",{
		                oninput: function (e) {Petition.current.mailAuteurPetition=e.target.value},
		                value: Petition.current.mailAuteurPetition
		            }),
		            m("label.label", "Titre :"),
		            m("input.input[type=text][placeholder=Titre de la pétition]", {
		                oninput: function (e) {Petition.current.titrePetition=e.target.value},
		                value: Petition.current.titrePetition
		            }),
		            m("label.label", "Description :"),
		            m("input.input[type=text][placeholder=Description de la pétition]", {
		                oninput: function (e) {Petition.current.descriptionPetition=e.target.value},
		                value: Petition.current.descriptionPetition
		            }),
		            m("button.button[type=submit]", "Créer la pétition"),
		        ])
		    }
	}
	
	//Formulaire de création de Vote
	var CreationVoteForm = {
			view: function() {
		        return m("form", {
		                onsubmit: function(e) {
		                    e.preventDefault()
		                    Vote.save()
		                }
		            }, [
		            m("label.label", "Titre pétition vote : "),
		            m("input.input[type=text][placeholder=Titre de la pétition]",{
		                oninput: function (e) {Vote.current.titrePetitionVote=e.target.value},
		                value: Vote.current.titrePetitionVote
		            }),
		            m("label.label", "Mail votant :"),
		            m("input.input[type=text][placeholder=Mail du votant]", {
		                oninput: function (e) {Vote.current.mailVotant=e.target.value},
		                value: Vote.current.mailVotant
		            }),
		            m("label.label", "Nom votant :"),
		            m("input.input[type=text][placeholder=Nom du votant]", {
		                oninput: function (e) {Vote.current.nomVotant=e.target.value},
		                value: Vote.current.nomVotant
		            }),
		            m("label.label", "Prénom votant :"),
		            m("input.input[type=text][placeholder=Prénom du votant]", {
		                oninput: function (e) {Vote.current.prenomVotant=e.target.value},
		                value: Vote.current.prenomVotant
		            }),
		            m("button.button[type=submit]", "Voter"),
		        ])
		    }
	}
m.mount(document.body, Hello)	


</script>
</body>
</html>